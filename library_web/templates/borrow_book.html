{% extends "base.html" %}

{% block content %}
<div class="content-header">
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-handshake"></i> Borrow Book</h1>
        <a href="{{ url_for('borrowings') }}" class="btn btn-light">
            <i class="fas fa-arrow-left"></i> Back to Borrowings
        </a>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-book"></i> Borrowing Information</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="book_id" class="form-label">Select Book *</label>
                            <select name="book_id" id="book_id" class="form-select" required>
                                <option value="">Choose a book...</option>
                                {% for book in books %}
                                    <option value="{{ book.id }}">{{ book.title }} - {{ book.author }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="member_id" class="form-label">Select Member *</label>
                            <select name="member_id" id="member_id" class="form-select" required>
                                <option value="">Choose a member...</option>
                                {% for member in members %}
                                    <option value="{{ member.id }}">{{ member.name }} ({{ member.email }})</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="days" class="form-label">Borrowing Period (Days)</label>
                            <select name="days" id="days" class="form-select">
                                <option value="7">1 Week (7 days)</option>
                                <option value="14" selected>2 Weeks (14 days)</option>
                                <option value="21">3 Weeks (21 days)</option>
                                <option value="30">1 Month (30 days)</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Due Date</label>
                            <div class="form-control" id="due-date-display">
                                <i class="fas fa-calendar"></i> <span id="due-date">Select borrowing period</span>
                            </div>
                        </div>
                    </div>
                    
                    {% if not books %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>No Available Books:</strong> All books are currently borrowed. Please wait for books to be returned.
                        </div>
                    {% elif not members %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>No Members:</strong> Please add members before borrowing books.
                        </div>
                    {% endif %}
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('borrowings') }}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary" {% if not books or not members %}disabled{% endif %}>
                            <i class="fas fa-handshake"></i> Borrow Book
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function updateDueDate() {
    const days = document.getElementById('days').value;
    const today = new Date();
    const dueDate = new Date(today.getTime() + (days * 24 * 60 * 60 * 1000));
    
    const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    };
    
    document.getElementById('due-date').textContent = dueDate.toLocaleDateString('en-US', options);
}

document.getElementById('days').addEventListener('change', updateDueDate);
// Initialize due date on page load
updateDueDate();
</script>
{% endblock %}
